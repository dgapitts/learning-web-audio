<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Synthesiser</title>

  <link rel="stylesheet" href="bootstrap-material-design.min.css">
  <style>
    ul {
      padding-left: 0;
    }

    ul li {
      list-style: none;
    }

    #synthesiserForm {
      margin-top: 2em;
    }

    #playButton {
      margin: 3em 0 2em;
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <h1 class="navbar-brand">
      Synthesiser
    </h1>
    <div class="navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item">
          <a class="nav-link" href="1-sawtooth-wave.html">Wave</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="2-chromatic-scale.html">scale</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="3-short-sequence.html">Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="4-add-a-high-pass-filter.html">Filter</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="5-modulate-filter-cutoff.html">Cutoff</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="6-add-an-envelope.html">Envelope</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="7-vibrato.html">Vibrato</a>
        </li>
      </ul>
    </div>
  </nav>

  <div class="container">
    <form id="synthesiserForm" action="#">
      <div class="form-group">
        <label for="frequencyRangeInput" class="bmd-label-static">
          Frequency: <span id="frequencyNumber"></span> Herz
        </label>
        <input type="range" class="form-control" id="frequencyRangeInput" value="440" min="55" max="1760" step="0.01">
      </div>

      <div class="form-group">
        <label for="delayRangeInput" class="bmd-label-static">
          Delay: <span id="delayNumber"></span> second
        </label>
        <input type="range" class="form-control" id="delayRangeInput" value="0" min="0" max="1" step="0.1">
      </div>

      <div class="form-group">
        <label for="durationRangeInput" class="bmd-label-static">
          Duration: <span id="durationNumber"></span> seconds
        </label>
        <input type="range" class="form-control" id="durationRangeInput" value="0.2" min="0" max="5" step="0.1">
      </div>

      <div class="form-group">
        <label for="oscillatorType" class="bmd-label-static">
          Oscillator type
        </label>
        <select name="oscillatorType" id="oscillatorType" class="btn btn-raised btn-secondary">
          <option value="triangle">Triangle</option>
          <option value="sawtooth">Sawtooth</option>
          <option value="square">Square</option>
          <option value="sine">Sine</option>
        </select>
      </div>

      <fieldset>
          <legend>Biquad Filtering</legend>
          <div class="form-group">
            <label for="biquadFilterType" class="bmd-label-static">Filter type</label>
            <select name="biquadFilterType" id="biquadFilterType" class="btn btn-raised btn-secondary">
              <option value="highpass">Highpass</option>
              <option value="lowpass">Lowpass</option>
            </select>
          </div>
          <div class="form-group">
            <label for="biquadFilterFrequencyRangeInput" class="bmd-label-static">
              Filter frequency: <span id="biquadFilterFrequencyNumber"></span> Herz
            </label>
            <input type="range" class="form-control" id="biquadFilterFrequencyRangeInput" value="10000" min="-20000" max="20000" step="100">
          </div>
      </fieldset>
  
      <p class="form-group">
        <button id="playButton" class="btn btn-raised btn-primary">Play</button>
      </p>
    </form>
    <p>Tutorials: <a href="http://mmckegg.github.io/web-audio-school/">web-audio-school</a></p>
  </div>

  <script>
    const form = document.getElementById('synthesiserForm');

    const frequencyNumber = document.getElementById('frequencyNumber');
    const frequencyRangeInput = document.getElementById('frequencyRangeInput');
    frequencyNumber.innerText = frequencyRangeInput.value;
    frequencyRangeInput.addEventListener('change', (e) => frequencyNumber.innerText = e.target.value);

    const delayNumber = document.getElementById('delayNumber');
    const delayRangeInput = document.getElementById('delayRangeInput');
    delayNumber.innerText = delayRangeInput.value;
    delayRangeInput.addEventListener('change', (e) => delayNumber.innerText = e.target.value);

    const durationNumber = document.getElementById('durationNumber');
    const durationRangeInput = document.getElementById('durationRangeInput');
    durationNumber.innerText = durationRangeInput.value;
    durationRangeInput.addEventListener('change', (e) => durationNumber.innerText = e.target.value);

    const oscillatorType = document.getElementById('oscillatorType');

    const biquadFilterType = document.getElementById('biquadFilterType');
    const biquadFilterFrequencyRangeInput = document.getElementById('biquadFilterFrequencyRangeInput');
    const biquadFilterFrequencyNumber = document.getElementById('biquadFilterFrequencyNumber');
    biquadFilterFrequencyNumber.innerText = biquadFilterFrequencyRangeInput.value;
    biquadFilterFrequencyRangeInput.addEventListener('change', (e) => biquadFilterFrequencyNumber.innerText = e.target.value);

    const playButton = document.getElementById('playButton');

    form.addEventListener('submit', (e) => e.preventDefault());

    const play = () => {
      const audioContext = new (AudioContext || window.webkitAudioContext)();
      
      const delay = parseFloat(delayRangeInput.value);
      const pitch = parseFloat(frequencyRangeInput.value);
      const duration = parseFloat(durationRangeInput.value);

      const startTime = audioContext.currentTime + delay;
      const endTime = startTime + duration;

      const oscillator = audioContext.createOscillator();
      oscillator.connect(audioContext.destination);

      oscillator.type = oscillatorType.value;
      oscillator.frequency.value = frequencyRangeInput.value;

      oscillator.start(startTime);
      oscillator.stop(endTime);      
    };

    playButton.addEventListener('click', play);
  </script>
</body>
</html>